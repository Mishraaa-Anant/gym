<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>WE 1 FITNESS STUDIO - Trainer Assessment Dashboard</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        /* Login Screen Styles */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .login-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .login-card h2 {
            color: #667eea;
            margin-bottom: 30px;
            font-size: 1.8rem;
        }

        .login-card .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .login-card .form-control {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .login-card .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .login-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .error-message {
            color: #dc3545;
            margin-top: 10px;
            font-size: 14px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 25px;
            position: relative;
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1rem;
            opacity: 0.9;
        }

        .header-controls {
            position: absolute;
            top: 0;
            display: flex;
            gap: 10px;
        }

        .back-btn {
            left: 0;
        }

        .download-btn {
            right: 0;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .input-panel {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            height: fit-content;
        }

        .results-panel {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .form-section {
            margin-bottom: 20px;
        }

        .form-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
            transition: transform 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.8rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            height: 350px;
            position: relative;
        }

        .chart-title {
            text-align: center;
            margin-bottom: 15px;
            color: #667eea;
            font-weight: bold;
            font-size: 1rem;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .recommendations {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .recommendations h3 {
            color: #d63384;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .recommendation-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 4px solid #d63384;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .hidden {
            display: none;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }

        .spinner {
            width: 35px;
            height: 35px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .assessment-type {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .type-btn {
            padding: 10px 12px;
            border: 2px solid #667eea;
            background: transparent;
            color: #667eea;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
            font-weight: 600;
            text-align: center;
        }

        .type-btn.active {
            background: #667eea;
            color: white;
        }

        /* Mobile Responsive Design */
        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .header-controls {
                position: relative;
                margin-top: 15px;
                justify-content: center;
            }
            
            .back-btn, .download-btn {
                position: relative;
                left: auto;
                right: auto;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 10px;
            }
            
            .metric-value {
                font-size: 1.5rem;
            }
            
            .metric-label {
                font-size: 0.7rem;
            }
            
            .chart-container {
                height: 300px;
                padding: 15px;
            }
            
            .assessment-type {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .input-panel, .results-panel {
                padding: 20px;
            }
            
            .login-card {
                padding: 30px 20px;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .header p {
                font-size: 0.9rem;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .metric-value {
                font-size: 1.3rem;
            }
            
            .chart-container {
                height: 250px;
                padding: 12px;
            }
            
            .form-control {
                padding: 8px 10px;
                font-size: 13px;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 14px;
            }
            
            .control-btn {
                padding: 8px 12px;
                font-size: 12px;
            }
        }

        /* Print Styles for PDF */
        @media print {
            body {
                background: white !important;
            }
            
            .header-controls, .btn, .control-btn {
                display: none !important;
            }
            
            .container {
                max-width: none !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            .dashboard {
                grid-template-columns: 1fr !important;
                gap: 10px !important;
            }
            
            .input-panel {
                display: none !important;
            }
            
            .results-panel {
                box-shadow: none !important;
                border: 1px solid #ddd !important;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-card">
            <h2><i class="fas fa-dumbbell"></i> WE 1 FITNESS STUDIO</h2>
            <p style="margin-bottom: 30px; color: #666;">Enter passcode to access Trainer Dashboard</p>
            <div class="form-group">
                <label>Passcode</label>
                <input type="password" class="form-control" id="passcode" placeholder="Enter passcode">
            </div>
            <button class="login-btn" onclick="checkPasscode()">
                <i class="fas fa-sign-in-alt"></i> Access Dashboard
            </button>
            <div class="error-message" id="errorMessage"></div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div class="container" id="mainDashboard" style="display: none;">
        <div class="header">
            <div class="header-controls">
                <button class="control-btn back-btn" onclick="goBack()">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <button class="control-btn download-btn" onclick="downloadReport()">
                    <i class="fas fa-download"></i> Download Report
                </button>
            </div>
            <h1><i class="fas fa-dumbbell"></i> WE 1 FITNESS STUDIO</h1>
            <p>Personal Training Assessment Dashboard</p>
        </div>

        <div class="dashboard">
            <!-- Input Panel -->
            <div class="input-panel">
                <div class="form-section">
                    <h3><i class="fas fa-user"></i> Client Information</h3>
                    <div class="form-group">
                        <label>Client Name</label>
                        <input type="text" class="form-control" id="clientName" placeholder="Enter client name">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Age</label>
                            <input type="number" class="form-control" id="age" min="16" max="80" placeholder="25">
                        </div>
                        <div class="form-group">
                            <label>Gender</label>
                            <select class="form-control" id="gender">
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-ruler"></i> Physical Measurements</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Height (cm)</label>
                            <input type="number" class="form-control" id="height" min="140" max="220" placeholder="170">
                        </div>
                        <div class="form-group">
                            <label>Weight (kg)</label>
                            <input type="number" class="form-control" id="weight" min="40" max="200" placeholder="70">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Body Fat % (optional)</label>
                            <input type="number" class="form-control" id="bodyFat" min="5" max="50" placeholder="15">
                        </div>
                        <div class="form-group">
                            <label>Muscle Mass % (optional)</label>
                            <input type="number" class="form-control" id="muscleMass" min="20" max="60" placeholder="35">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-heartbeat"></i> Fitness Assessment</h3>
                    <div class="assessment-type">
                        <button class="type-btn active" onclick="selectAssessment('beginner')">Beginner</button>
                        <button class="type-btn" onclick="selectAssessment('intermediate')">Intermediate</button>
                        <button class="type-btn" onclick="selectAssessment('advanced')">Advanced</button>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Push-ups (max)</label>
                            <input type="number" class="form-control" id="pushups" min="0" max="100" placeholder="20">
                        </div>
                        <div class="form-group">
                            <label>Plank (seconds)</label>
                            <input type="number" class="form-control" id="plank" min="0" max="600" placeholder="60">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Flexibility (1-10)</label>
                            <input type="number" class="form-control" id="flexibility" min="1" max="10" placeholder="7">
                        </div>
                        <div class="form-group">
                            <label>Cardio Level (1-10)</label>
                            <input type="number" class="form-control" id="cardio" min="1" max="10" placeholder="6">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-target"></i> Goals & Preferences</h3>
                    <div class="form-group">
                        <label>Primary Goal</label>
                        <select class="form-control" id="goal">
                            <option value="weight_loss">Weight Loss</option>
                            <option value="muscle_gain">Muscle Gain</option>
                            <option value="strength">Strength Building</option>
                            <option value="endurance">Endurance</option>
                            <option value="general_fitness">General Fitness</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Workout Frequency (per week)</label>
                        <select class="form-control" id="frequency">
                            <option value="2">2 times</option>
                            <option value="3">3 times</option>
                            <option value="4">4 times</option>
                            <option value="5">5 times</option>
                            <option value="6">6 times</option>
                        </select>
                    </div>
                </div>

                <button class="btn" onclick="generateAssessment()">
                    <i class="fas fa-chart-line"></i> Generate Assessment
                </button>
            </div>

            <!-- Results Panel -->
            <div class="results-panel" id="reportContent">
                <div id="loadingState" class="hidden">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                    <p style="text-align: center; margin-top: 15px;">Analyzing client data and generating insights...</p>
                </div>

                <div id="resultsContent" class="hidden">
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-value" id="bmiValue">0</div>
                            <div class="metric-label">BMI Score</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="fitnessScore">0</div>
                            <div class="metric-label">Fitness Score</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="progressPotential">0%</div>
                            <div class="metric-label">Progress Potential</div>
                        </div>
                    </div>

                    <div class="charts-grid">
                        <div class="chart-container">
                            <h4 class="chart-title">Fitness Profile</h4>
                            <canvas id="fitnessRadar"></canvas>
                        </div>
                        <div class="chart-container">
                            <h4 class="chart-title">Body Composition</h4>
                            <canvas id="bodyComposition"></canvas>
                        </div>
                    </div>

                    <div class="chart-container">
                        <h4 class="chart-title">Goal-Based Progress Projection (12 weeks)</h4>
                        <canvas id="progressChart"></canvas>
                    </div>

                    <div class="recommendations">
                        <h3><i class="fas fa-lightbulb"></i> Personalized Recommendations</h3>
                        <div id="recommendationsList"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentAssessment = 'beginner';
        let charts = {};
        const correctPasscode = 'Weone2025';

        // Login functionality
        function checkPasscode() {
            const enteredPasscode = document.getElementById('passcode').value;
            const errorElement = document.getElementById('errorMessage');
            
            if (enteredPasscode === correctPasscode) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainDashboard').style.display = 'block';
                errorElement.textContent = '';
            } else {
                errorElement.textContent = 'Invalid passcode. Please try again.';
                document.getElementById('passcode').value = '';
                document.getElementById('passcode').focus();
            }
        }

        // Allow Enter key to submit passcode
        document.getElementById('passcode').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkPasscode();
            }
        });

        // Back button functionality
        function goBack() {
            window.location.href = 'index.html';
        }

        // Download report functionality
        // Improved PDF generation function
async function downloadReport() {
    const clientName = document.getElementById('clientName').value || 'Client';
    
    if (document.getElementById('resultsContent').classList.contains('hidden')) {
        alert('Please generate an assessment first before downloading the report.');
        return;
    }

    try {
        // Show loading indicator
        const originalText = document.querySelector('.download-btn').innerHTML;
        document.querySelector('.download-btn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
        document.querySelector('.download-btn').disabled = true;

        // Create PDF using jsPDF directly
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('p', 'mm', 'a4');
        
        // Get client data
        const data = {
            name: document.getElementById('clientName').value || 'Client',
            age: document.getElementById('age').value || 'N/A',
            gender: document.getElementById('gender').value,
            height: document.getElementById('height').value || 'N/A',
            weight: document.getElementById('weight').value || 'N/A',
            bmi: document.getElementById('bmiValue').textContent,
            fitnessScore: document.getElementById('fitnessScore').textContent,
            progressPotential: document.getElementById('progressPotential').textContent,
            goal: document.getElementById('goal').options[document.getElementById('goal').selectedIndex].text,
            frequency: document.getElementById('frequency').value || 'N/A'
        };

        // PDF dimensions
        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();
        const margin = 20;
        let yPosition = margin;

        // Header
        pdf.setFillColor(102, 126, 234);
        pdf.rect(0, 0, pageWidth, 40, 'F');
        
        pdf.setTextColor(255, 255, 255);
        pdf.setFontSize(24);
        pdf.setFont('helvetica', 'bold');
        pdf.text('WE 1 FITNESS STUDIO', pageWidth / 2, 20, { align: 'center' });
        
        pdf.setFontSize(14);
        pdf.setFont('helvetica', 'normal');
        pdf.text('Fitness Assessment Report', pageWidth / 2, 32, { align: 'center' });
        
        yPosition = 55;

        // Client Information Section
        pdf.setTextColor(0, 0, 0);
        pdf.setFontSize(16);
        pdf.setFont('helvetica', 'bold');
        pdf.text('CLIENT INFORMATION', margin, yPosition);
        yPosition += 10;

        pdf.setFontSize(12);
        pdf.setFont('helvetica', 'normal');
        const clientInfo = [
            `Name: ${data.name}`,
            `Age: ${data.age} years`,
            `Gender: ${data.gender.charAt(0).toUpperCase() + data.gender.slice(1)}`,
            `Height: ${data.height} cm`,
            `Weight: ${data.weight} kg`,
            `Primary Goal: ${data.goal}`,
            `Workout Frequency: ${data.frequency} times per week`,
            `Assessment Date: ${new Date().toLocaleDateString()}`
        ];

        clientInfo.forEach(info => {
            pdf.text(info, margin, yPosition);
            yPosition += 7;
        });

        yPosition += 10;

        // Assessment Results Section
        pdf.setFontSize(16);
        pdf.setFont('helvetica', 'bold');
        pdf.text('ASSESSMENT RESULTS', margin, yPosition);
        yPosition += 15;

        // Metrics boxes
        const metrics = [
            { label: 'BMI Score', value: data.bmi, color: [102, 126, 234] },
            { label: 'Fitness Score', value: data.fitnessScore, color: [118, 75, 162] },
            { label: 'Progress Potential', value: data.progressPotential, color: [255, 99, 132] }
        ];

        const boxWidth = (pageWidth - margin * 2 - 20) / 3;
        let xPosition = margin;

        metrics.forEach((metric, index) => {
            // Draw metric box
            pdf.setFillColor(metric.color[0], metric.color[1], metric.color[2]);
            pdf.roundedRect(xPosition, yPosition, boxWidth, 25, 3, 3, 'F');
            
            // Metric value
            pdf.setTextColor(255, 255, 255);
            pdf.setFontSize(18);
            pdf.setFont('helvetica', 'bold');
            pdf.text(metric.value.toString(), xPosition + boxWidth / 2, yPosition + 12, { align: 'center' });
            
            // Metric label
            pdf.setFontSize(10);
            pdf.setFont('helvetica', 'normal');
            pdf.text(metric.label, xPosition + boxWidth / 2, yPosition + 20, { align: 'center' });
            
            xPosition += boxWidth + 10;
        });

        yPosition += 40;

        // Fitness Profile Section
        pdf.setTextColor(0, 0, 0);
        pdf.setFontSize(16);
        pdf.setFont('helvetica', 'bold');
        pdf.text('FITNESS PROFILE', margin, yPosition);
        yPosition += 15;

        // Get fitness data for the profile
        const pushups = parseInt(document.getElementById('pushups').value) || 0;
        const plank = parseInt(document.getElementById('plank').value) || 0;
        const flexibility = parseInt(document.getElementById('flexibility').value) || 5;
        const cardio = parseInt(document.getElementById('cardio').value) || 5;

        const strengthScore = Math.min((pushups / 30) * 10, 10).toFixed(1);
        const enduranceScore = Math.min((plank / 120) * 10, 10).toFixed(1);

        const fitnessProfile = [
            { category: 'Strength (Push-ups)', score: strengthScore, maxScore: 10 },
            { category: 'Endurance (Plank)', score: enduranceScore, maxScore: 10 },
            { category: 'Flexibility', score: flexibility, maxScore: 10 },
            { category: 'Cardio Level', score: cardio, maxScore: 10 },
            { category: 'Balance', score: 6, maxScore: 10 }
        ];

        pdf.setFontSize(12);
        pdf.setFont('helvetica', 'normal');

        fitnessProfile.forEach(item => {
            const barWidth = 120;
            const barHeight = 8;
            const scoreWidth = (item.score / item.maxScore) * barWidth;

            // Category label
            pdf.text(item.category, margin, yPosition);
            
            // Score text
            pdf.text(`${item.score}/10`, margin + 130, yPosition);
            
            // Background bar
            pdf.setFillColor(230, 230, 230);
            pdf.rect(margin + 150, yPosition - 5, barWidth, barHeight, 'F');
            
            // Score bar
            pdf.setFillColor(102, 126, 234);
            pdf.rect(margin + 150, yPosition - 5, scoreWidth, barHeight, 'F');
            
            yPosition += 12;
        });

        yPosition += 15;

        // Recommendations Section
        if (yPosition > pageHeight - 60) {
            pdf.addPage();
            yPosition = margin;
        }

        pdf.setFontSize(16);
        pdf.setFont('helvetica', 'bold');
        pdf.text('PERSONALIZED RECOMMENDATIONS', margin, yPosition);
        yPosition += 15;

        // Get recommendations
        const recommendations = getRecommendationsForPDF(data);
        
        pdf.setFontSize(11);
        pdf.setFont('helvetica', 'normal');

        recommendations.forEach((recommendation, index) => {
            if (yPosition > pageHeight - 30) {
                pdf.addPage();
                yPosition = margin;
            }

            // Bullet point
            pdf.setFillColor(102, 126, 234);
            pdf.circle(margin + 3, yPosition - 2, 1.5, 'F');
            
            // Recommendation text with text wrapping
            const lines = pdf.splitTextToSize(recommendation, pageWidth - margin * 2 - 15);
            pdf.text(lines, margin + 10, yPosition);
            yPosition += lines.length * 5 + 3;
        });

        // Footer
        const footerY = pageHeight - 20;
        pdf.setFillColor(102, 126, 234);
        pdf.rect(0, footerY, pageWidth, 20, 'F');
        
        pdf.setTextColor(255, 255, 255);
        pdf.setFontSize(10);
        pdf.setFont('helvetica', 'normal');
        pdf.text('Generated by WE 1 FITNESS STUDIO - Professional Training Assessment', pageWidth / 2, footerY + 12, { align: 'center' });

        // Save the PDF
        const fileName = `${data.name.replace(/\s+/g, '_')}_Fitness_Assessment_${new Date().toISOString().split('T')[0]}.pdf`;
        pdf.save(fileName);

        // Reset button
        document.querySelector('.download-btn').innerHTML = originalText;
        document.querySelector('.download-btn').disabled = false;

    } catch (error) {
        console.error('Error generating PDF:', error);
        alert('Error generating PDF. Please try again.');
        
        // Reset button on error
        document.querySelector('.download-btn').innerHTML = '<i class="fas fa-download"></i> Download Report';
        document.querySelector('.download-btn').disabled = false;
    }
}

// Helper function to get recommendations for PDF
function getRecommendationsForPDF(data) {
    const recommendations = [];
    const bmi = parseFloat(data.bmi);
    const fitnessScore = parseInt(data.fitnessScore);
    
    // BMI-based recommendations
    if (bmi < 18.5) {
        recommendations.push("Focus on strength training and increased caloric intake to build healthy muscle mass.");
    } else if (bmi > 25) {
        recommendations.push("Combine cardio exercises with strength training for effective weight management.");
    }
    
    // Fitness level recommendations
    if (fitnessScore < 40) {
        recommendations.push("Start with basic bodyweight exercises and gradually increase intensity.");
        recommendations.push("Focus on consistency - aim for 20-30 minute sessions to build a strong foundation.");
    } else if (fitnessScore < 70) {
        recommendations.push("Incorporate progressive overload by gradually increasing weights or repetitions.");
        recommendations.push("Add variety to your routine with compound movements and functional exercises.");
    } else {
        recommendations.push("Challenge yourself with advanced techniques like supersets and plyometrics.");
        recommendations.push("Consider specialized training protocols for your specific performance goals.");
    }
    
    // Goal-specific recommendations
    const goalRecommendations = {
        'Weight Loss': [
            "Maintain a moderate caloric deficit while preserving muscle mass through resistance training.",
            "Include 150-300 minutes of moderate cardio or 75-150 minutes of vigorous cardio weekly."
        ],
        'Muscle Gain': [
            "Prioritize compound movements like squats, deadlifts, and bench press in your routine.",
            "Ensure adequate protein intake (1.6-2.2g per kg body weight) to support muscle growth."
        ],
        'Strength Building': [
            "Focus on low-rep, high-intensity training with proper progression schemes.",
            "Allow adequate rest between sessions for optimal strength adaptations."
        ],
        'Endurance': [
            "Gradually increase training volume and incorporate interval training methods.",
            "Build aerobic base with longer, steady-state sessions complemented by high-intensity intervals."
        ],
        'General Fitness': [
            "Maintain a balanced approach combining strength, cardio, and flexibility training.",
            "Vary your routine regularly to prevent plateaus and maintain motivation."
        ]
    };
    
    if (goalRecommendations[data.goal]) {
        recommendations.push(...goalRecommendations[data.goal]);
    }
    
    // Frequency-based recommendations
    const frequency = parseInt(data.frequency);
    if (frequency < 3) {
        recommendations.push("Consider increasing workout frequency to 3-4 times per week for optimal results.");
    } else if (frequency > 5) {
        recommendations.push("Ensure adequate recovery time between intense sessions to prevent overtraining.");
    }
    
    // Age-specific recommendations
    const age = parseInt(data.age);
    if (age > 50) {
        recommendations.push("Include mobility work and joint-friendly exercises in your routine.");
        recommendations.push("Pay extra attention to warm-up and cool-down phases.");
    }
    
    return recommendations;
}

        function selectAssessment(type) {
            currentAssessment = type;
            document.querySelectorAll('.type-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function generateAssessment() {
            // Show loading state
            document.getElementById('loadingState').classList.remove('hidden');
            document.getElementById('resultsContent').classList.add('hidden');

            // Simulate processing time
            setTimeout(() => {
                processAssessment();
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('resultsContent').classList.remove('hidden');
            }, 2000);
        }

        function processAssessment() {
            // Get form data
            const data = {
                name: document.getElementById('clientName').value || 'Client',
                age: parseInt(document.getElementById('age').value) || 25,
                gender: document.getElementById('gender').value,
                height: parseInt(document.getElementById('height').value) || 170,
                weight: parseInt(document.getElementById('weight').value) || 70,
                bodyFat: parseInt(document.getElementById('bodyFat').value) || null,
                muscleMass: parseInt(document.getElementById('muscleMass').value) || null,
                pushups: parseInt(document.getElementById('pushups').value) || 0,
                plank: parseInt(document.getElementById('plank').value) || 0,
                flexibility: parseInt(document.getElementById('flexibility').value) || 5,
                cardio: parseInt(document.getElementById('cardio').value) || 5,
                goal: document.getElementById('goal').value,
                frequency: parseInt(document.getElementById('frequency').value) || 3
            };

            // Calculate metrics
            const bmi = (data.weight / ((data.height / 100) ** 2)).toFixed(1);
            const fitnessScore = calculateFitnessScore(data);
            const progressPotential = calculateProgressPotential(data);

            // Update metrics
            document.getElementById('bmiValue').textContent = bmi;
            document.getElementById('fitnessScore').textContent = fitnessScore;
            document.getElementById('progressPotential').textContent = progressPotential + '%';

            // Generate charts
            createFitnessRadar(data);
            createBodyComposition(data);
            createProgressChart(data);
            generateRecommendations(data);
        }

        function calculateFitnessScore(data) {
            let score = 0;
            
            // Strength component (pushups)
            const pushupBenchmarks = { beginner: 10, intermediate: 25, advanced: 40 };
            score += Math.min((data.pushups / pushupBenchmarks[currentAssessment]) * 25, 25);
            
            // Endurance component (plank)
            const plankBenchmarks = { beginner: 30, intermediate: 60, advanced: 120 };
            score += Math.min((data.plank / plankBenchmarks[currentAssessment]) * 25, 25);
            
            // Flexibility component
            score += (data.flexibility / 10) * 25;
            
            // Cardio component
            score += (data.cardio / 10) * 25;
            
            return Math.round(score);
        }

        function calculateProgressPotential(data) {
            let potential = 50; // Base potential
            
            // Age factor
            if (data.age < 25) potential += 20;
            else if (data.age < 35) potential += 15;
            else if (data.age < 45) potential += 10;
            else if (data.age < 55) potential += 5;
            
            // Frequency factor
            potential += (data.frequency - 2) * 5;
            
            // Current fitness level (inverse relationship - lower fitness = higher potential)
            const currentFitness = calculateFitnessScore(data);
            potential += Math.max(0, (80 - currentFitness) / 2);
            
            return Math.min(Math.round(potential), 95);
        }

        function createFitnessRadar(data) {
            const ctx = document.getElementById('fitnessRadar').getContext('2d');
            
            if (charts.fitnessRadar) {
                charts.fitnessRadar.destroy();
            }
            
            const strengthScore = Math.min((data.pushups / 30) * 10, 10);
            const enduranceScore = Math.min((data.plank / 120) * 10, 10);
            
            charts.fitnessRadar = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Strength', 'Endurance', 'Flexibility', 'Cardio', 'Balance'],
                    datasets: [{
                        label: 'Current Level',
                        data: [strengthScore, enduranceScore, data.flexibility, data.cardio, 6],
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(102, 126, 234, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 10,
                            ticks: {
                                stepSize: 2
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function createBodyComposition(data) {
            const ctx = document.getElementById('bodyComposition').getContext('2d');
            
            if (charts.bodyComposition) {
                charts.bodyComposition.destroy();
            }
            
            // Estimate body composition if not provided
            let bodyFat = data.bodyFat;
            let muscleMass = data.muscleMass;
            
            if (!bodyFat) {
                // Rough estimation based on BMI and gender
                const bmi = data.weight / ((data.height / 100) ** 2);
                if (data.gender === 'male') {
                    bodyFat = Math.max(8, Math.min(25, (bmi - 20) * 2 + 15));
                } else {
                    bodyFat = Math.max(12, Math.min(35, (bmi - 20) * 2 + 20));
                }
            }
            
            if (!muscleMass) {
                muscleMass = data.gender === 'male' ? 42 : 36;
            }
            
            const other = 100 - bodyFat - muscleMass;
            
            charts.bodyComposition = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Muscle Mass', 'Body Fat', 'Other'],
                    datasets: [{
                        data: [muscleMass, bodyFat, other],
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(255, 205, 86, 0.8)'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        function createProgressChart(data) {
            const ctx = document.getElementById('progressChart').getContext('2d');
            
            if (charts.progressChart) {
                charts.progressChart.destroy();
            }
            
            // Generate progress projection based on goal
            const weeks = ['Week 1', 'Week 2', 'Week 4', 'Week 6', 'Week 8', 'Week 10', 'Week 12'];
            let progressData = [];
            
            const currentFitness = calculateFitnessScore(data);
            const targetImprovement = getTargetImprovement(data.goal);
            
            weeks.forEach((week, index) => {
                const weekNumber = index === 0 ? 1 : index === 1 ? 2 : (index - 1) * 2 + 2;
                const progressPercent = Math.min(100, (weekNumber / 12) * targetImprovement);
                progressData.push(currentFitness + (progressPercent / 100) * (95 - currentFitness));
            });
            
            charts.progressChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: weeks,
                    datasets: [{
                        label: 'Projected Fitness Score',
                        data: progressData,
                        borderColor: 'rgba(102, 126, 234, 1)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: 'rgba(102, 126, 234, 1)',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Fitness Score'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Training Progress'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function getTargetImprovement(goal) {
            const improvements = {
                'weight_loss': 70,
                'muscle_gain': 85,
                'strength': 90,
                'endurance': 80,
                'general_fitness': 75
            };
            return improvements[goal] || 75;
        }

        function generateRecommendations(data) {
            const container = document.getElementById('recommendationsList');
            const recommendations = [];
            
            const bmi = data.weight / ((data.height / 100) ** 2);
            const fitnessScore = calculateFitnessScore(data);
            
            // BMI-based recommendations
            if (bmi < 18.5) {
                recommendations.push("Focus on strength training and increased caloric intake to build healthy muscle mass.");
            } else if (bmi > 25) {
                recommendations.push("Combine cardio exercises with strength training for effective weight management.");
            }
            
            // Fitness level recommendations
            if (fitnessScore < 40) {
                recommendations.push("Start with basic bodyweight exercises and gradually increase intensity.");
                recommendations.push("Focus on consistency - aim for 20-30 minute sessions to build a strong foundation.");
            } else if (fitnessScore < 70) {
                recommendations.push("Incorporate progressive overload by gradually increasing weights or repetitions.");
                recommendations.push("Add variety to your routine with compound movements and functional exercises.");
            } else {
                recommendations.push("Challenge yourself with advanced techniques like supersets and plyometrics.");
                recommendations.push("Consider specialized training protocols for your specific performance goals.");
            }
            
            // Goal-specific recommendations
            const goalRecommendations = {
                'weight_loss': [
                    "Maintain a moderate caloric deficit while preserving muscle mass through resistance training.",
                    "Include 150-300 minutes of moderate cardio or 75-150 minutes of vigorous cardio weekly."
                ],
                'muscle_gain': [
                    "Prioritize compound movements like squats, deadlifts, and bench press in your routine.",
                    "Ensure adequate protein intake (1.6-2.2g per kg body weight) to support muscle growth."
                ],
                'strength': [
                    "Focus on low-rep, high-intensity training with proper progression schemes.",
                    "Allow adequate rest between sessions for optimal strength adaptations."
                ],
                'endurance': [
                    "Gradually increase training volume and incorporate interval training methods.",
                    "Build aerobic base with longer, steady-state sessions complemented by high-intensity intervals."
                ],
                'general_fitness': [
                    "Maintain a balanced approach combining strength, cardio, and flexibility training.",
                    "Vary your routine regularly to prevent plateaus and maintain motivation."
                ]
            };
            
            recommendations.push(...goalRecommendations[data.goal]);
            
            // Frequency-based recommendations
            if (data.frequency < 3) {
                recommendations.push("Consider increasing workout frequency to 3-4 times per week for optimal results.");
            } else if (data.frequency > 5) {
                recommendations.push("Ensure adequate recovery time between intense sessions to prevent overtraining.");
            }
            
            // Age-specific recommendations
            if (data.age > 50) {
                recommendations.push("Include mobility work and joint-friendly exercises in your routine.");
                recommendations.push("Pay extra attention to warm-up and cool-down phases.");
            }
            
            // Generate HTML
            container.innerHTML = recommendations.map(rec => 
                `<div class="recommendation-item">${rec}</div>`
            ).join('');
        }

        // Auto-focus on passcode input when page loads
        window.addEventListener('load', function() {
            document.getElementById('passcode').focus();
        });

        // Add some sample data for testing (remove in production)
        window.addEventListener('load', function() {
            // Uncomment below lines for testing with sample data
            /*
            setTimeout(() => {
                document.getElementById('clientName').value = 'John Doe';
                document.getElementById('age').value = '28';
                document.getElementById('height').value = '175';
                document.getElementById('weight').value = '75';
                document.getElementById('pushups').value = '25';
                document.getElementById('plank').value = '90';
                document.getElementById('flexibility').value = '7';
                document.getElementById('cardio').value = '6';
            }, 100);
            */
           
        });
    </script>
</body>
</html>